- name: Build update report
      ansible.builtin.set_fact:
        update_report:
          host: "{{ inventory_hostname }}"
          ansible_host: "{{ ansible_host }}"
          product: "{{ wso2_product | default('apim') }}"
          product_version: "{{ wso2_version | default('Unknown') }}"
          current_level: "{{ current_update_level }}"
          latest_level: "{{ latest_available_level }}"
          hotfixes_applied: "{{ current_hotfixes }}"
          updates_available: "{{ updates_available }}"
          updates_count: "{{ available_updates_count }}"
          has_conflicts: "{{ has_conflicts }}"
          conflict_files: "{{ conflict_files }}"
          conflict_count: "{{ conflict_files | length }}"
          dry_run_id: "{{ dry_run_id }}"
          dry_run_path: "{{ dry_run_path }}"
          report_url: "{{ report_url | default('') }}"
          status: "{{ update_status | trim }}"
          status_emoji: "{{ update_status_emoji | trim }}"
          tool_version: "{{ tool_version_output.stdout_lines[0] | default('Unknown') }}"
          check_timestamp: "{{ ansible_date_time.iso8601 }}"
